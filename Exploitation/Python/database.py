import sqlite3 as sql

class Database:
    def __init__(self, file_name):
        self.database = sql.connect(file_name, isolation_level = None)
        self.cursor = self.database.cursor()

    def __del__(self):
        self.cursor.close()
        self.database.close()

    def getLast(self):
        request = self.cursor.execute("SELECT *, MAX(id) FROM options;")
        idd, start, end, step, avg, pylons_str, max_id = request.fetchone()
        pylons = []
        if pylons_str != "":
            pylons = [[int(n) for n in i.split(";")] for i in pylons_str.split(',')]
        return [start, end, step, avg, pylons]

    def addValue(self, start, end, step, avg, pylons):
        pylons_str = ""
        for pylon in pylons:
            pylons_str += f"{pylon[0]};{pylon[1]},"
        pylons_str = pylons_str[:-1]

        request = f"INSERT INTO options VALUES (null, {start}, {end}, {step}, {avg}, \"{pylons_str}\");"
        print(request)
        self.cursor.execute(request)
